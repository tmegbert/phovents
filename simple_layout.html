<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8" />
<title>Simple Layout Engine</title>
<style type="text/css">

    body {
        width: 48em;
        margin: 2.4em auto;
        font-family: "Constantia", serif;
    }
    
    h1 {
        font-size: 2.0em;
        margin: 1.0em 0;
        font-weight: normal;
        text-transform: uppercase;
        letter-spacing: 0.15em;
    }
    
    div.layout-row * {
        font-family: "Consolas", sans-serif;
        padding: 0.0em;
    }

</style>

<script type="text/javascript">

    var nominal_height = 240;
    var gutter = 20;
    
    function num(str) {
        return parseFloat(str);
    }
    
    function round(x) {
        if (x < 0) return Math.ceil(x - 0.5);
        return Math.floor(x + 0.5);
    }
    
    function layout_row_new(parent) {
        var width = parent.getBoundingClientRect().width;
        
        var child = parent.childNodes;
        parent.panel = []
        
        for (var i = 0; i < child.length; i++) {
            var ch = child[i];
            
            if (ch.nodeType == 1) {        
                ch.orig = ch.getBoundingClientRect();
                ch.width = ch.orig.width * nominal_height / ch.orig.height;
                ch.height = nominal_height;
                
                var j = parent.panel.length;
                var done = false;
                while (j--) {
                    var p = parent.panel[j];
                    
                    if (p.width + gutter + ch.width < width) {
                        p.elem.push(ch);
                        p.width += gutter + ch.width;
                        done = true;
                        break;
                    } 
                }
                
                if (!done) {
                    var o = {
                        width: ch.width, 
                        elem: [ch]
                    };
                    parent.panel.push(o);
                }
            }
        }
            
        var top = 0;
        for (var j = 0; j < parent.panel.length; j++) {
            var p = parent.panel[j];
            var gtr = (p.elem.length - 1) * gutter;
            var left = 0;
            var c = (width - gtr) / (p.width - gtr);

            p.height = p.elem[0].height * c;

            for (var k = 0; k < p.elem.length; k++) {
                var e = p.elem[k];

                e.width *= c;
                e.height = p.height;

                e.style.position = "absolute";
                e.style.top = top + "px";
                e.style.left = left + "px";
                e.style.width = e.width + "px";
                e.style.height = e.height + "px";
                e.innerHTML = e.orig.width 
                    + " x " + e.orig.height + " ("
                    + round(100 * e.width / e.orig.width) + "%)";
                left += e.width + gutter;
            }
            top += p.height + gutter;
        }
        parent.style.position = "relative";
        parent.style.height = (top - gutter) + "px";
    }
    
    window.onload = function() {
        var ly = document.getElementsByTagName("DIV");
        
        for (var i = 0; i < ly.length; i++) {
            if (ly[i].className == "layout-row") {
                layout_row_new(ly[i]);                
            }
        }
    }
    
</script>
</head>

<body>

<h1>Simple Layout Engine</h1>

<div class="layout-row">
    <div style="width: 300px; height: 200px;"><img src="images/magic/Powell/thumb/Powell_2015 - 1.jpg"></div>
    <div style="width: 300px; height: 200px;"><img src="images/magic/Powell/thumb/Powell_2015 - 2.jpg"></div>
    <div style="width: 300px; height: 200px;"><img src="images/magic/Powell/thumb/Powell_2015 - 3.jpg"></div>
    <div style="width: 300px; height: 200px;"><img src="images/magic/Powell/thumb/Powell_2015 - 4.jpg"></div>
    <div style="width: 300px; height: 200px;"><img src="images/magic/Powell/thumb/Powell_2015 - 5.jpg"></div>
    <div style="width: 300px; height: 200px;"><img src="images/magic/Powell/thumb/Powell_2015 - 6.jpg"></div>
    <div style="width: 300px; height: 200px;"><img src="images/magic/Powell/thumb/Powell_2015 - 7.jpg"></div>
    <div style="width: 300px; height: 200px;"><img src="images/magic/Powell/thumb/Powell_2015 - 8.jpg"></div>
    <div style="width: 300px; height: 200px;"><img src="images/magic/Powell/thumb/Powell_2015 - 9.jpg"></div>
    <div style="width: 200px; height: 133px;"><img src="images/magic/Powell/thumb/Powell_2015 - 10.jpg"></div>
    <div style="width: 200px; height: 133px;"><img src="images/magic/Powell/thumb/Powell_2015 - 11.jpg"></div>
    <div style="width: 300px; height: 200px;"><img src="images/magic/Powell/thumb/Powell_2015 - 12.jpg"></div>
    <div style="width: 300px; height: 200px;"><img src="images/magic/Powell/thumb/Powell_2015 - 13.jpg"></div>
</div>

</body>

</html>

